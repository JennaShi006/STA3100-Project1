---
title: "Project-1"
author: "Haoran Shi and Jingyao Zhang"
date: "2024-10-17"
output: pdf_document
bibliography: references.bib
csl: apa-with-abstract.csl
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(dplyr)
library(knitr)
```

```{r, include = FALSE}
esg.data = read.csv("sp500_esg_data.csv")


```

# Abstract ## Tina

#Introduction ## Tina

# Data #Do Respective data

# Analysis and Results
## cite R, RStudio here
*To see top 5% company that with lowest score, and to explore correlation between score and type of industry 
Within 90th percentile companies, pie chart of percentage each industry in the 90th percentile 
```{r plot1}
```{r plot1}
# Identify top 10% companies with lowest score
top_10_percent_value <- quantile(data$totalEsg, probs=0.10)
companies_with_lowest_score <- data |> filter(totalEsg <= top_10_percent_value)
kable(companies_with_lowest_score, caption = "Top 10% Companies with the Lowest ESG Scores")

# Create a pie chart to explore the distribution of industries in the 90th percentile
sector <- companies_with_lowest_score |>
  count("GICS.Sector") |>
  
ggplot(sector, aes(x = "", y = n, fill = "GICS Sector")) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar(theta = "y") +
  labs(title = "Industry Distribution in the 90th Percentile of ESG Scores") +
  theme_void()
```


```

*To investigate 3 industries (information technology, healthcare, financial) distributed in which percentile, category into 4, 0-25, 25-50, 50-75, 75-100
grouped Bar plot
```{r plot 2}
library(ggplot2)

#creates new column categorizing each entry into quartiles based on their percentile
for (i in 1:nrow(esg.data)){
    
    if (25.0>=esg.data$percentile[i]){
        esg.data$quartiles[i] = "Quartile 1"
    } else if (50>=esg.data$percentile[i]){
        esg.data$quartiles[i] = "Quartile 2"
    } else if (75>=esg.data$percentile[i]){
        esg.data$quartiles[i] = "Quartile 3"
    } else{
        esg.data$quartiles[i] = "Quartile 4"
    }
}
#Creates a subset of esg.data with only the 3 selected sectors

esg.data.industries= data.frame(subset(esg.data, GICS.Sector== "Information Technology"| esg.data$GICS.Sector == "Health Care" | esg.data$GICS.Sector == "Financials"))


industries = c("Information Technology", "Health Care", "Financials")

quartiles = c("Quartile 1","Quartile 2", "Quartile 3","Quartile 4")


heights = vector("numeric",12)
mod.index = 0
for (i in 1:4){
    for (j in 1:3){
        heights[j+mod.index] = nrow(esg.data.industries[esg.data.industries$GICS.Sector == industries[j] & esg.data.industries$quartiles == quartiles[i],])
        
    }
    mod.index = mod.index +3
    
}
# creates new data frame with only necessary data
mod.data = data.frame(Quantity = heights, Industries = c(industries, industries, industries, industries), Quartiles = rep(quartiles, each =3))

# creates grouped bar plot                      
ggplot(mod.data, aes(fill= Industries, y= Quantity, x= Quartiles)) +
geom_bar(stat = "identity", position = "dodge") + labs(title = "Quantity of Companies in Select Industries versus Quartile from ESG Score Percentile") + theme(plot.title = element_text(size = 11)) 

```

*To count categorize companies into five risk levels, negligible, low, medium, high, severe 
To see if s&p 500 companies intended to control their score under low or medium level 
Histogram: categories by risk level, frequency of companies for each risk level
See trend.


Explore Correlation between governance scores and industry type
```{r plot 3}
industries = c("Communication Services","Consumer Discretionary", "Consumer Staples", "Energy", "Financials", "Health Care", "Industrials", "Information Technology", "Materials", "Real Estate", "Utilities")

gov.averages = vector("numeric", length(industries))

for (i in 1:length(gov.averages)){
    gov.averages[i] = mean(esg.data$governanceScore[which(esg.data$GICS.Sector == industries[i])])
}

barplot(height = gov.averages, xlab = "Industries", ylab = "Mean Governance Scores", main = "Mean Governance Scores versus Industry Sector", las = 2, col = colours()[c(3,16,29,46,67,76,91,106,121,136,151)])
legend("topright", col= colours()[c(3,16,29,46,67,76,91,106,121,136,151)], legend = industries, cex = 0.5, pch = 16, ncol = 2)
```



# Conclusion #Jenna

# Contribution Statement

# References ## Jenna
@greenchoicenowWhatsScore
@R



